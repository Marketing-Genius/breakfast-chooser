<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fambam ¬∑ Home</title>

<meta name="theme-color" content="#0d1327">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icon-192.png"/>

<style>
:root{
  --bg:#0d1327;
  --panel: rgba(13,19,39,.5);
  --card: rgba(17,24,39,.85);
  --muted:#94a3b8;
  --text:#e5e7eb;
  --accent:#22d3ee;
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --radius:18px;
}

/* Page */
html,body{height:100%}
body{
  margin:0; color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  background: var(--bg);
  -webkit-tap-highlight-color:transparent; touch-action:manipulation;
}

/* Wallpaper layer */
.wallpaper{
  position:fixed; inset:0; z-index:-1;
  background: var(--bg) center/cover no-repeat;
}
.wallpaper::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(to bottom, rgba(13,19,39,0.20), rgba(13,19,39,0.85) 70%, rgba(13,19,39,0.95) 100%);
}

/* Top bar */
.topbar{
  position:sticky; top:0; z-index:50;
  backdrop-filter: blur(10px);
  background: var(--panel);
  border-bottom:1px solid rgba(255,255,255,.08);
}
.topbar-inner{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 16px;
}
.brand{ display:flex; gap:10px; align-items:center; }
.brand img{ height:28px; width:auto; display:block; }

.menu-wrap{ position:relative }
.menu-btn{
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
  color:var(--text); border-radius:12px; padding:8px 10px; cursor:pointer;
}
.menu{
  position:absolute; right:0; top:46px; min-width:220px;
  background:rgba(17,24,39,.95); border:1px solid rgba(255,255,255,.12);
  border-radius:14px; box-shadow:var(--shadow); padding:8px;
  display:none; z-index:60;
}
.menu a, .menu button{
  display:flex; width:100%; text-align:left; gap:10px; align-items:center;
  background:transparent; border:0; color:var(--text); padding:10px 12px;
  border-radius:10px; cursor:pointer;
}
.menu a:hover, .menu button:hover{ background:rgba(255,255,255,.06) }

/* Layout */
.app{min-height:100%; display:flex; flex-direction:column}
.content{flex:1; display:flex; flex-direction:column}

/* Bottom-anchored cards */
.cards-wrap{ display:flex; flex-direction:column; flex:1 }
.spacer{ flex:1 } /* pushes cards to bottom */
.cards{
  display:grid; gap:12px;
  grid-template-columns:repeat(2,minmax(0,1fr));
  padding:0 16px 20px 16px; /* 20px bottom gap as requested */
}
@media(min-width:840px){
  .cards{ grid-template-columns:repeat(3,minmax(0,330px)); justify-content:center }
}
.card{
  display:flex; gap:12px; align-items:center; justify-content:space-between;
  background:var(--card); border:1px solid rgba(255,255,255,.08);
  border-radius:16px; padding:14px 16px; text-decoration:none; color:var(--text);
  box-shadow:var(--shadow);
}
.card:hover{ outline:2px solid rgba(34,211,238,.35) }
.card .title{ font-weight:800 }
.card .subtitle{ color:var(--muted); font-size:.9rem }
.card .icon{ font-size:1.4rem }

/* Footer note */
.note{ text-align:center; padding:6px 12px 14px; color:#8fb7ff; opacity:.7; font-size:.9rem }

/* ---- Splash (Lottie) ---- */
#splash{
  position:fixed; inset:0; z-index:100000;
  display:none; place-items:center;
  background:#0d1327;
  transition: opacity 1s ease; /* 1s fade-out */
}
#splash .box{
  width:min(960px, 60vw);   /* ~50% of 1920, responsive */
  aspect-ratio: 16 / 9;     /* AE comp ratio */
  display:grid; place-items:center;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  #splash { transition:none }
}
</style>
</head>
<body>
  <!-- One-time splash -->
  <div id="splash" aria-hidden="true">
    <div class="box" id="lottieBox"></div>
  </div>

  <!-- Wallpaper -->
  <div id="wallpaper" class="wallpaper"></div>

  <div class="app">
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <img src="fambam.png" alt="Fambam"/>
        </div>
        <div class="menu-wrap">
          <button id="menuBtn" class="menu-btn" aria-haspopup="true" aria-expanded="false">‚ò∞</button>
          <div id="menu" class="menu" role="menu" aria-hidden="true">
            <button id="editWallpaper">üñºÔ∏è Edit Wallpaper</button>
            <button id="clearWallpaper">üóëÔ∏è Remove Wallpaper</button>
            <button id="adminSettings">‚öôÔ∏è Admin Settings</button>
          </div>
        </div>
      </div>
    </div>

    <div class="content">
      <div class="spacer"></div>

      <div class="cards-wrap">
        <div class="cards">
          <a class="card" href="./breakfast.html">
            <div>
              <div class="title">Breakfast</div>
              <div class="subtitle">Daily picks for the kids</div>
            </div>
            <div class="icon">üç≥</div>
          </a>

          <a class="card" href="./dinner.html">
            <div>
              <div class="title">Dinner Planner</div>
              <div class="subtitle">Week plan ¬∑ templates ¬∑ groceries</div>
            </div>
            <div class="icon">üçΩÔ∏è</div>
          </a>

          <!-- ENABLED chores link -->
          <a class="card" href="./chores.html">
            <div>
              <div class="title">Chores</div>
              <div class="subtitle">Weekly rotation</div>
            </div>
            <div class="icon">üßπ</div>
          </a>

          <a class="card" href="./calendar.html" style="opacity:.6; pointer-events:none">
            <div>
              <div class="title">Family Calendar</div>
              <div class="subtitle">Coming soon</div>
            </div>
            <div class="icon">üìÜ</div>
          </a>
        </div>

        <div class="note">Works offline ¬∑ data stays on this device</div>
      </div>
    </div>
  </div>

  <!-- Hidden file input for wallpaper -->
  <input id="wallpaperInput" type="file" accept="image/*" style="display:none"/>

  <!-- (Optional) family store include if your admin modal relies on it -->
  <script src="family.js?v=3.3.6"></script>

  <!-- Lottie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" integrity="sha512-Eu9e6iYjP2cJ9e9WoP4o32Cptq0SxQ5uGKV1wSRqYb8xJzvEbv1n5JfYzVCskCqXG8eTtnQ0gW/5z2gK8u1QfQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
  /* -------- Wallpaper load/save -------- */
  (function(){
    const KEY='hub:home:wallpaper';
    const box=document.getElementById('wallpaper');
    function apply(){
      try{
        const v=localStorage.getItem(KEY);
        if(!v){ box.style.backgroundImage='none'; return; }
        box.style.backgroundImage = `url(${JSON.parse(v)})`;
      }catch{ box.style.backgroundImage='none'; }
    }
    apply();

    const input=document.getElementById('wallpaperInput');
    document.getElementById('editWallpaper').onclick=()=>input.click();
    input.onchange=(e)=>{
      const f=e.target.files && e.target.files[0]; if(!f) return;
      const r=new FileReader();
      r.onload=()=>{ localStorage.setItem(KEY, JSON.stringify(r.result)); apply(); };
      r.readAsDataURL(f);
      input.value="";
    };
    document.getElementById('clearWallpaper').onclick=()=>{
      localStorage.removeItem(KEY); apply();
    };
  })();

  /* -------- Menu toggle -------- */
  (function(){
    const btn=document.getElementById('menuBtn');
    const menu=document.getElementById('menu');
    btn.addEventListener('click',()=>{
      const open=menu.style.display==='block';
      menu.style.display = open ? 'none' : 'block';
      btn.setAttribute('aria-expanded', open?'false':'true');
      menu.setAttribute('aria-hidden', open?'true':'false');
    });
    document.addEventListener('click',(e)=>{
      if (!menu.contains(e.target) && e.target!==btn) {
        menu.style.display='none';
        btn.setAttribute('aria-expanded','false');
        menu.setAttribute('aria-hidden','true');
      }
    });

    // Admin: trigger both hash and event, so either handler works
    document.getElementById('adminSettings').onclick=()=>{
      try{ location.hash = '#admin'; }catch{}
      try{ window.dispatchEvent(new CustomEvent('open-admin')); }catch{}
      menu.style.display='none';
      btn.setAttribute('aria-expanded','false');
      menu.setAttribute('aria-hidden','true');
    };
  })();

  /* -------- One-time Lottie splash (2s + 1s fade) -------- */
  (function runSplashOnce(){
    const KEY='fambam:splash:shown:v2'; // new key so it will show once
    if (sessionStorage.getItem(KEY)) return;

    const splash=document.getElementById('splash');
    const box=document.getElementById('lottieBox');
    if(!splash || !box || !window.lottie){ sessionStorage.setItem(KEY,'1'); return; }

    splash.style.display='grid';
    splash.style.opacity='1';

    const anim=lottie.loadAnimation({
      container: box,
      renderer: 'svg',
      loop: false,
      autoplay: true,
      path: 'splash.json', // put your JSON at site root
      rendererSettings: { preserveAspectRatio: 'xMidYMid meet', progressiveLoad:true }
    });

    let finished=false;
    function endSplash(){
      if(finished) return;
      finished=true;
      sessionStorage.setItem(KEY,'1');
      splash.style.opacity='0';               // 1s fade as per CSS
      setTimeout(()=>{ try{splash.remove();}catch{} }, 1000);
    }

    anim.addEventListener('complete', endSplash);
    anim.addEventListener('data_failed', endSplash);
    setTimeout(endSplash, 3000); // safety: 2s anim + 1s fade budget
  })();

  /* -------- Service worker -------- */
  if('serviceWorker' in navigator){
    window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(()=>{}));
  }
  </script>
</body>
</html>
