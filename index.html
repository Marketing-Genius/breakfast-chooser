<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fambam</title>

<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.webmanifest">

<style>
*, *::before, *::after { box-sizing: border-box; }

:root{
  --panel:#111827; --card:#1f2937; --muted:#94a3b8; --text:#e5e7eb; --accent:#22d3ee;
  --bg:#0f172a; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
  --wallpaper:url('');
  --wallpaper-shift: 40%;
  --slotH: 230px;    /* taller so preview fits better */
}
html,body{height:100%}
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  color:var(--text); background:#0f172a; overflow-x:hidden;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-2;
  background-image: var(--wallpaper);
  background-size: cover; background-repeat:no-repeat;
  background-position: center var(--wallpaper-shift);
}
body::after{
  content:""; position:fixed; inset:0; z-index:-1;
  background: rgba(18,24,38,.9);
  pointer-events:none;
}
.app{min-height:100svh;display:flex;flex-direction:column;gap:18px;padding:20px;max-width:1100px;margin:0 auto}

/* Header */
header{
  position:relative; z-index:9000; isolation:isolate;
  display:flex;justify-content:space-between;align-items:center;
  background:rgba(17,24,39,.5); border:1px solid rgba(11,18,36,.3);
  border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;
  backdrop-filter: blur(8px);
}
.title{display:flex;align-items:center;gap:10px}
.title img{height:38px;display:block}
.menu-wrap{position:relative; z-index:9001}
.hamburger{cursor:pointer;background:rgba(11,18,36,.6);color:#e5e7eb;border:1px solid #334155;border-radius:12px;padding:10px 12px}
.menu-dropdown{
  position:absolute;right:0;top:110%;min-width:260px;z-index:9002;
  background:#111827;border:1px solid #1f2937;border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);padding:6px;display:none
}
.menu-dropdown.open{display:block}
.menu-item{width:100%;text-align:left;padding:10px 12px;border:none;background:transparent;color:#e5e7eb;border-radius:10px;cursor:pointer}
.menu-item:hover{background:#0b1224}

/* Grid */
#slots{margin-top:12px;display:grid;gap:16px;grid-template-columns:repeat(4,minmax(0,1fr));grid-auto-rows:var(--slotH)}
@media(max-width:860px){#slots{grid-template-columns:repeat(2,minmax(0,1fr))}}
.slot{height:var(--slotH);border-radius:16px;position:relative}
.slot.editing{outline:2px dashed #334155;background:rgba(2,6,23,.25)}
.slot.editing .add-btn{position:absolute;inset:auto 10px 10px auto;background:#0b1224;border:1px dashed #334155;color:#cbd5e1;border-radius:999px;width:44px;height:44px;display:grid;place-items:center;cursor:pointer}

/* Tile */
.tile{
  position:relative;display:flex;flex-direction:column;gap:10px;align-items:flex-start;
  background:rgba(31,41,55,.9);border:1px solid rgba(31,41,55,.95);
  border-radius:16px;padding:16px;text-decoration:none;color:var(--text);
  box-shadow:var(--shadow);backdrop-filter: blur(4px);
  height:100%;overflow:hidden;
}
.tile .emoji{font-size:36px}
.tile .label{font-weight:800}
.tile .hint{opacity:.8}
.tile .minus{position:absolute;right:8px;bottom:8px;width:36px;height:36px;display:none;place-items:center;font-weight:800;background:#3f1620;border:1px solid #7f1d1d;color:#fecaca;border-radius:999px}
.editing .tile .minus{display:grid;cursor:pointer}
.tile.selecting{outline:2px solid var(--accent)}

/* Breakfast preview */
.bf-preview{
  margin-top:6px;
  background:#0b1224;
  border:1px solid #334155;
  border-radius:12px;
  padding:8px;
}
.bf-header{font-weight:800;font-size:.9rem;color:#e5e7eb;opacity:.95;margin-bottom:6px}
.bf-grid{display:flex;flex-wrap:wrap;gap:8px}
.bf-chip{display:flex;align-items:center;gap:6px;padding:6px 8px;background:#0a1222;border:1px solid #2b3b55;border-radius:999px}
.bf-chip .face{width:22px;height:22px;border-radius:50%;overflow:hidden;display:grid;place-items:center;border:1px solid #334155;font-size:.75rem;line-height:1}
.bf-chip .face img{width:100%;height:100%;object-fit:cover}
.bf-chip .emoji{font-size:20px;line-height:1}
@media(max-height:560px){
  .bf-chip{padding:4px 6px;gap:5px}
  .bf-chip .face{width:18px;height:18px;font-size:.7rem}
  .bf-chip .emoji{font-size:18px}
  .bf-header{font-size:.85rem}
}

/* Edit bar */
#editBar{display:none;align-items:center;justify-content:space-between;margin-top:6px;padding:10px 12px;border-radius:12px;background:rgba(17,24,39,.65);border:1px solid #1f2937}
#editBar.show{display:flex}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="title"><img src="fambam.png" alt="Fambam"></div>
    <div class="menu-wrap">
      <button id="btnMenu" class="hamburger">‚ò∞</button>
      <div id="menuDropdown" class="menu-dropdown">
        <button class="menu-item" data-action="edithome">Edit Home</button>
        <button class="menu-item" data-action="admin">Admin Settings</button>
        <button class="menu-item" data-action="wallpaper">Edit Wallpaper</button>
        <button class="menu-item" data-action="clearwp">Clear Wallpaper</button>
        <button class="menu-item" data-action="about">About</button>
      </div>
    </div>
  </header>

  <div id="editBar">
    <div>Tap a card, then tap a slot to move it. Use ‚Äú+‚Äù to add. Tap ‚Äú‚àí‚Äù to remove.</div>
    <div style="display:flex;gap:10px">
      <button id="btnAddAnywhere" class="btn">Add/Remove Card</button>
      <button id="btnDoneEdit" class="btn-primary">Done</button>
    </div>
  </div>

  <main id="slots"></main>
</div>

<!-- Family Store -->
<script src="family.js?v=3.3.6"></script>
<script>
if (!window.Family) {
  window.Family = { getKids:()=>[], getActiveKids:()=>[] };
}
</script>

<script>
const SLOT_KEY='hub:home:slots:v2';
const SLOTS_TOTAL=16;
const CARDS=[
  {id:'breakfast',href:'./breakfast.html',emoji:'üçΩÔ∏è',label:'Breakfast'},
  {id:'dinner',href:'./dinner.html',emoji:'üçù',label:'Dinner Planner'},
  {id:'chores',href:'./chores.html',emoji:'üßπ',label:'Chores'},
  {id:'calendar',href:'./calendar.html',emoji:'üìÖ',label:'Family Calendar'},
  {id:'photos',href:'./photos.html',emoji:'üñºÔ∏è',label:'Photos'}
];
const byId=Object.fromEntries(CARDS.map(c=>[c.id,c]));

function loadSlots(){try{const v=JSON.parse(localStorage.getItem(SLOT_KEY));if(Array.isArray(v))return v.slice(0,SLOTS_TOTAL).concat(Array(SLOTS_TOTAL).fill(null)).slice(0,SLOTS_TOTAL);}catch{}return ['breakfast','dinner','chores','calendar'].concat(Array(SLOTS_TOTAL-4).fill(null));}
function saveSlots(a){localStorage.setItem(SLOT_KEY,JSON.stringify(a));}
let slots=loadSlots(),isEditing=false,selectedCardId=null,selectedFromSlot=-1;
const $=(s,e=document)=>e.querySelector(s); const $$=(s,e=document)=>[...e.querySelectorAll(s)];
function todayISO(){const d=new Date();return d.toISOString().slice(0,10);}

function kidFaceHTML(kid){if(kid?.photo)return `<img src="${kid.photo}">`;return `<span>${(kid?.name||'?')[0].toUpperCase()}</span>`;}
function makeKidEmojiChip(kid,emoji){return `<div class="bf-chip"><div class="face">${kidFaceHTML(kid)}</div><div class="emoji">${emoji}</div></div>`;}

function renderGrid(){const wrap=$('#slots');wrap.innerHTML='';for(let i=0;i<SLOTS_TOTAL;i++){const div=document.createElement('div');div.className='slot'+(isEditing?' editing':'');div.dataset.pos=i;const id=slots[i];if(id&&byId[id]){div.appendChild(renderTile(byId[id],i));}else if(isEditing){const add=document.createElement('button');add.className='add-btn';add.textContent='+';div.appendChild(add);}wrap.appendChild(div);}}
function renderTile(c,slotIndex){const a=document.createElement('a');a.href=c.href;a.className='tile';
if(c.id==='breakfast'){const cont=document.createElement('div');cont.innerHTML=`<div class="emoji">${c.emoji}</div><div class="label">${c.label}</div>`;a.appendChild(cont);
const preview=document.createElement('div');preview.className='bf-preview';preview.innerHTML=`<div class="bf-header">Today ¬∑ ${new Date().toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'})}</div><div class="bf-grid"></div>`;a.appendChild(preview);
const menu=JSON.parse(localStorage.getItem('bf:menu')||'[]');const sel=JSON.parse(localStorage.getItem('bf:day:'+todayISO())||'{}');const kids=Family.getActiveKids();const grid=preview.querySelector('.bf-grid');let any=false;kids.forEach(k=>{const choice=sel[k.id];if(choice!=null&&menu[choice]){grid.insertAdjacentHTML('beforeend',makeKidEmojiChip(k,menu[choice].emoji));any=true;}});if(!any)grid.innerHTML='<div class="small">No selections yet.</div>'; }
else{a.innerHTML=`<div class="emoji">${c.emoji}</div><div class="label">${c.label}</div><div class="hint">${c.hint||''}</div>`;}
return a;}
renderGrid();
</script>
</body>
</html>
