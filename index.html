<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Breakfast Chooser</title>

  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">

  <style>
    :root {
      --panel:#111827; --card:#1f2937; --muted:#6b7280; --text:#e5e7eb; --accent:#22d3ee;
      --bg:#0f172a; --ok:#34d399; --warn:#fb7185; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
    }
    body {
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background:linear-gradient(180deg, #0b1026 0%, #0f172a 100%); color:var(--text);
      -webkit-tap-highlight-color: transparent; touch-action: manipulation;
    }
    .app{max-width:1100px; margin:0 auto; padding:20px; display:grid; gap:18px; grid-template-rows:auto auto 1fr auto;}
    header{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .title{font-weight:800; letter-spacing:.2px;}
    .title .small{font-weight:600; font-size:.8rem; color:var(--muted)}
    .panel{background:var(--panel); border:1px solid #111827; box-shadow: var(--shadow); border-radius: var(--radius); padding:14px;}
    .controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    input[type="date"], button, select, input[type="text"]{
      font: inherit; color:var(--text); background:var(--card); border:1px solid #374151; border-radius:12px; padding:10px 14px;
    }
    .btn-primary{background: linear-gradient(180deg,#22d3ee,#06b6d4); color:#001018; border:none; font-weight:700; cursor:pointer}
    .btn-ghost{background:transparent; border:1px dashed #334155; color:var(--muted); cursor:pointer}
    .btn-warn{background:#3f1620; border:1px solid #7f1d1d; color:#fecaca; cursor:pointer}
    .kids.panel{display:flex; gap:12px; align-items:center; overflow:auto;}
    .kid{display:flex; align-items:center; gap:10px; padding:10px 12px; background:var(--card); border:1px solid #1f2937; border-radius:14px; min-width: 210px; user-select:none;}
    .kid[aria-selected="true"]{outline:2px solid var(--accent);}
    .face{width:56px; height:56px; border-radius:50%; background:#0b1224; display:grid; place-items:center; font-size:28px; border:2px solid #334155; overflow:hidden}
    .face img{width:100%; height:100%; object-fit:cover}
    .choices{display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:14px}
    @media (min-width:900px){ .choices{grid-template-columns: repeat(4,minmax(0,1fr));} }
    .choice{background:var(--panel); border:1px solid #1f2937; border-radius:var(--radius); padding:14px; display:flex; flex-direction:column; gap:12px; min-height: 210px}
    .food-emoji{font-size:36px; filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));}
    .avatars{display:flex; flex-wrap:wrap; gap:8px; min-height:44px}
    .avatar{width:40px; height:40px; border-radius:50%; background:#0b1224; display:grid; place-items:center; font-size:20px; border:2px solid #334155;}
    .avatar img{width:100%; height:100%; object-fit:cover; border-radius:50%}
    .summary.panel{display:grid; gap:10px}
    .summary-item{display:flex; align-items:center; justify-content:space-between; background:var(--card); border:1px solid #1f2937; padding:10px 12px; border-radius:12px}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#0b1224; border:1px solid #334155; font-weight:700}
    .footer{text-align:center; font-size:.85rem; opacity:.7}
    .version{font-size:.8rem; opacity:.6}
    .modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:10000; padding:20px;}
    .modal{width:min(860px, 100%); background:var(--panel); border:1px solid #1f2937; border-radius:16px; box-shadow:var(--shadow);}
    .modal .body{padding:14px 16px; display:grid; gap:16px;}
    .row.addkid{margin-top:10px;}
  </style>
</head>
<body>
  <div class="app">
    <header class="panel">
      <div class="title">
        <div style="font-size: 1.6rem">Breakfast Chooser</div>
        <div class="small">Tap a child, then tap a food card to choose.</div>
      </div>
      <div class="controls">
        <input id="theDate" type="date" />
        <button id="btnClear" class="btn-ghost">Reset Day</button>
        <button id="btnRandomize" class="btn-ghost">Randomize</button>
        <button id="btnShare" class="btn-primary">Copy Summary</button>
        <button id="btnAdmin" class="btn-ghost">⚙️</button>
      </div>
    </header>

    <section class="kids panel" id="kidsRow"></section>
    <section class="choices" id="choicesGrid"></section>
    <section class="summary panel" id="summary"></section>
    <div class="footer">
      Works offline. Data stays on this device (local only).
      <div class="version">v3.2.3</div>
    </div>
  </div>

  <input type="file" id="file-picker" accept="image/*" class="sr-only" />

  <!-- Admin Modal -->
  <div class="modal-backdrop" id="adminModal">
    <div class="modal">
      <header><div>Admin</div><button id="adminClose">✖</button></header>
      <div class="body">
        <!-- tabs + content built by JS -->
        <div id="kidsList"></div>
        <div class="row addkid">
          <input type="text" id="newKidName" placeholder="Add kid name">
          <button id="addKid" class="btn-primary">Add Kid</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* simplified: only showing key change for photo compression */
async function compressImage(file, maxSide=256, quality=0.8){
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => {
      const scale = Math.min(1, maxSide/Math.max(img.width,img.height));
      const w = Math.round(img.width*scale), h = Math.round(img.height*scale);
      const canvas=document.createElement('canvas'); canvas.width=w; canvas.height=h;
      canvas.getContext('2d').drawImage(img,0,0,w,h);
      resolve(canvas.toDataURL('image/jpeg', quality));
    };
    const r=new FileReader(); r.onload=()=>{img.src=r.result}; r.readAsDataURL(file);
  });
}
</script>
</body>
</html>
