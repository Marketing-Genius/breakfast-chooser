<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Breakfast Chooser</title>

<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.webmanifest">

<style>
:root{
  --panel:#111827; --card:#1f2937; --muted:#6b7280; --text:#e5e7eb; --accent:#22d3ee;
  --bg:#0f172a; --ok:#34d399; --warn:#fb7185; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
}
html,body{height:100%}
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  background:linear-gradient(180deg,#0b1026 0%,#0f172a 100%); color:var(--text);
  -webkit-tap-highlight-color:transparent; touch-action:manipulation;
}
.app{max-width:1100px; margin:0 auto; padding:20px; display:grid; gap:18px; grid-template-rows:auto auto 1fr auto}
header{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap}
.title{font-weight:800; letter-spacing:.2px}
.title .small{font-weight:600; font-size:.8rem; color:var(--muted)}
.panel{background:var(--panel); border:1px solid #111827; box-shadow:var(--shadow); border-radius:var(--radius); padding:14px}
.controls{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
input[type="date"],button,select,input[type="text"]{font:inherit; color:var(--text); background:var(--card); border:1px solid #374151; border-radius:12px; padding:10px 14px}
button{cursor:pointer}
.btn-primary{background:linear-gradient(180deg,#22d3ee,#06b6d4); color:#001018; border:none; font-weight:700}
.btn-ghost{background:transparent; border:1px dashed #334155; color:var(--muted)}
.icon-btn{padding:6px 10px; border-radius:10px; border:1px solid #334155; background:#0b1224; cursor:pointer}

/* Back-to-home button */
.btn-back{
  display:inline-block; text-decoration:none; font-weight:800;
  background:#0b1224; color:#e5e7eb; border:1px solid #334155;
  padding:10px 12px; border-radius:12px;
}
.btn-back:active{ transform: translateY(1px); }

/* Smaller icon-only ‚ÄúCopy‚Äù button */
.btn-icon{
  display:inline-grid; place-items:center; width:44px; height:44px; padding:0;
  border-radius:12px;
}

/* Layout pieces */
.kids.panel{display:flex; gap:12px; align-items:center; overflow:auto}
.kid{display:flex; align-items:center; gap:10px; padding:10px 12px; background:var(--card); border:1px solid #1f2937; border-radius:14px; min-width:210px; user-select:none}
.kid[aria-selected="true"]{outline:2px solid var(--accent)}
.face{width:56px; height:56px; border-radius:50%; background:#0b1224; display:grid; place-items:center; font-size:28px; border:2px solid #334155; overflow:hidden}
.face img{width:100%; height:100%; object-fit:cover}

.choices{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px}
@media (min-width:900px){ .choices{grid-template-columns:repeat(4,minmax(0,1fr))} }
.choice{background:var(--panel); border:1px solid #1f2937; border-radius:var(--radius); padding:14px; display:flex; flex-direction:column; gap:12px; min-height:210px}
.food-head{display:flex; align-items:center; gap:10px}
.food-emoji{font-size:36px; filter:drop-shadow(0 6px 10px rgba(0,0,0,.35))}
.avatars{display:flex; flex-wrap:wrap; gap:8px; min-height:44px}
.avatar{width:40px; height:40px; border-radius:50%; background:#0b1224; display:grid; place-items:center; font-size:20px; border:2px solid #334155}
.avatar img{width:100%; height:100%; object-fit:cover; border-radius:50%}
.empty-hint{margin-top:auto; font-size:.9rem; color:var(--muted)}

.summary.panel{display:grid; grid-template-columns:repeat(1,minmax(0,1fr)); gap:10px}
@media (min-width:760px){ .summary.panel{grid-template-columns:repeat(2,minmax(0,1fr))} }
.summary-item{display:flex; align-items:center; justify-content:space-between; background:var(--card); border:1px solid #1f2937; padding:10px 12px; border-radius:12px}
.pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#0b1224; border:1px solid #334155; font-weight:700}
.pill .emoji{font-size:18px}

.footer{text-align:center; opacity:.7; font-size:.85rem}
.version{opacity:.6; font-size:.8rem; margin-top:6px}

.sr-only{position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

.modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:10000; padding:20px}
.modal{width:min(860px,100%); background:var(--panel); border:1px solid #1f2937; border-radius:16px; box-shadow:var(--shadow)}
.modal header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #1f2937}
.modal .body{padding:14px 16px; display:grid; gap:16px}
.modal .footer{padding:14px 16px; border-top:1px solid #1f2937; display:flex; justify-content:flex-end; gap:10px}
.tabs{display:flex; gap:8px; flex-wrap:wrap}
.tab{padding:8px 12px; border-radius:10px; background:#0b1224; border:1px solid #334155; cursor:pointer}
.tab[aria-selected="true"]{outline:2px solid var(--accent)}
.grid{display:grid; gap:10px}
.grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
@media (max-width:740px){ .grid.cols-2{grid-template-columns:1fr} }
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.row.addkid{margin-top:10px}
.list{display:grid; gap:8px}
.item{display:flex; align-items:center; gap:10px; background:var(--card); border:1px solid #1f2937; border-radius:12px; padding:10px}
.item .grow{flex:1}
.btn-warn{background:#3f1620; border:1px solid #7f1d1d; color:#fecaca}
.small{font-size:.9rem}
.hint{font-size:.85rem; color:var(--muted)}
</style>
</head>
<body>
  <div class="app">
    <header class="panel">
      <div class="title">
        <div style="font-size:1.6rem">Breakfast Chooser</div>
        <div class="small">Tap a child, then tap a food card to choose.</div>
      </div>
      <div class="controls">
        <label class="sr-only" for="theDate">Date</label>
        <input id="theDate" type="date"/>

        <!-- Back to Home -->
        <a href="./index.html" class="btn-back" title="Back to Home">‚Üê Home</a>

        <button id="btnClear" class="btn-ghost">Reset Day</button>
        <button id="btnRandomize" class="btn-ghost">Randomize</button>

        <!-- Icon-only Copy (keeps primary styling, smaller size) -->
        <button id="btnShare" class="btn-primary btn-icon" title="Copy Summary" aria-label="Copy Summary">üìã</button>

        <button id="btnAdmin" class="icon-btn" title="Admin">‚öôÔ∏è</button>
      </div>
    </header>

    <section class="kids panel" id="kidsRow" aria-label="Kids"></section>
    <section class="choices" id="choicesGrid" aria-label="Breakfast choices"></section>
    <section class="summary panel" id="summary"></section>

    <div class="footer">
      Works offline. Data stays on this device (local only).
      <div class="version">v3.2.4</div>
    </div>
  </div>

  <!-- Hidden file picker -->
  <input type="file" id="file-picker" accept="image/*" class="sr-only"/>

  <!-- Admin Modal -->
  <div class="modal-backdrop" id="adminModal" aria-hidden="true" role="dialog" aria-labelledby="adminTitle">
    <div class="modal">
      <header>
        <div id="adminTitle" style="font-weight:800">Admin</div>
        <button id="adminClose" class="icon-btn">‚úñ</button>
      </header>
      <div class="body">
        <div class="tabs">
          <button class="tab" data-tab="kids" aria-selected="true">Kids</button>
          <button class="tab" data-tab="menu">Menu Options</button>
        </div>

        <div class="tab-panel" data-panel="kids">
          <div class="list" id="kidsList"></div>
          <div class="row addkid">
            <input type="text" id="newKidName" placeholder="Add kid name">
            <button id="addKid" class="btn-primary">Add Kid</button>
            <div class="hint">Tip: Add a photo after creating.</div>
          </div>
        </div>

        <div class="tab-panel" data-panel="menu" style="display:none">
          <div class="grid cols-2">
            <div>
              <div class="row">
                <select id="menuEmoji"></select>
                <input type="text" id="menuLabel" placeholder="Menu item label (e.g., Oatmeal)">
                <button id="addMenu" class="btn-primary">Add</button>
              </div>
              <div class="hint">You can store up to 10 total menu items.</div>
              <div class="list" id="menuList"></div>
            </div>
            <div>
              <div class="row"><div style="font-weight:800">Active Daily Choices (max 4)</div></div>
              <div class="list" id="activeList"></div>
              <div class="hint">Only active choices appear on the main screen.</div>
            </div>
          </div>
        </div>
      </div>
      <div class="footer">
        <button id="adminSave" class="btn-primary">Save</button>
        <button id="adminCancel" class="btn-ghost">Cancel</button>
      </div>
    </div>
  </div>

<script>
// ---- Utilities & storage ----
const $  = (s,e=document)=>e.querySelector(s);
const $$ = (s,e=document)=>[...e.querySelectorAll(s)];
const LS = { kids:'bc:kids', menu:'bc:menu:all', active:'bc:menu:active', day:d=>`bc:choices:${d}` };

function uid(){ return Math.random().toString(36).slice(2,10) }
function load(k,f){ try{ const v=JSON.parse(localStorage.getItem(k)); return v ?? f }catch(_){ return f } }
function save(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
function today(){ return new Date().toISOString().slice(0,10) }
function initials(n){ const p=(n||'').trim().split(/\s+/).filter(Boolean); return ((p[0]?p[0][0]:'?')+(p[1]?p[1][0]:'' )).toUpperCase() }
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) }

// ---- Defaults & seed ----
const DEFAULT_KIDS = [
  { id: uid(), name: 'Emilia',   photo: null },
  { id: uid(), name: 'Hudson',   photo: null },
  { id: uid(), name: 'Penelope', photo: null },
  { id: uid(), name: 'Jasper',   photo: null },
];
const DEFAULT_MENU = [
  { id: uid(), emoji: 'üßá', label: 'Waffles w/ Syrup (Eggo)' },
  { id: uid(), emoji: 'üçì', label: 'Pop-Tart (various)' },
  { id: uid(), emoji: 'ü•£', label: 'Cereal (various)' },
  { id: uid(), emoji: 'ü•Ø', label: 'Bagel & Cream Cheese' },
];
const EMOJI_CHOICES = ['üßá','üçì','ü•£','ü•Ø','üçå','üç≥','ü•û','üßÅ','üçé','üßÄ','ü•õ','‚òïÔ∏è','üç´','üç™','ü•ê','ü•ó','üçä','üçá','üçç','üåØ'];

function ensureSeed(){
  let kids = load(LS.kids, null); if (!Array.isArray(kids) || kids.length===0){ kids = DEFAULT_KIDS; save(LS.kids, kids); }
  let menu = load(LS.menu, null); if (!Array.isArray(menu) || menu.length===0){ menu = DEFAULT_MENU; save(LS.menu, menu); }
  let act  = load(LS.active, null); if (!Array.isArray(act) || act.length===0){ act = menu.slice(0,4).map(m=>m.id); save(LS.active, act); }
}

// ---- Accessors ----
function getKids(){ return load(LS.kids, DEFAULT_KIDS) }
function setKids(a){ save(LS.kids,a) }
function getAllMenu(){ return load(LS.menu, DEFAULT_MENU) }
function setAllMenu(a){ save(LS.menu,a) }
function getActive(){ let a=load(LS.active,null); if(!a){ a=getAllMenu().slice(0,4).map(m=>m.id); setActive(a);} return a }
function setActive(ids){ save(LS.active, ids.slice(0,4)) }
function getDay(d){ return load(LS.day(d),{}) }
function setDay(d,o){ save(LS.day(d),o) }

// ---- Rendering ----
let activeKid = null;

function renderKids(){
  const row = $('#kidsRow'); if (!row) return;
  row.innerHTML='';
  getKids().forEach(k => {
    const el = document.createElement('div');
    el.className='kid'; el.dataset.kid=k.id; el.setAttribute('role','button');
    el.setAttribute('aria-selected', activeKid===k.id ? 'true':'false');
    el.innerHTML = `
      <div class="face">${k.photo?`<img alt="${escapeHtml(k.name)}" src="${k.photo}">`:`<span>${initials(k.name)}</span>`}</div>
      <div><div style="font-weight:800">${escapeHtml(k.name)}</div><div style="color:var(--muted); font-size:.8rem; visibility:hidden">.</div></div>`;
    row.appendChild(el);
  });
}

function renderChoices(){
  const grid = $('#choicesGrid'); if (!grid) return;
  grid.innerHTML='';
  const date = $('#theDate').value; const picks = getDay(date);
  const all = getAllMenu(); const actIds = getActive();
  const act = all.filter(m=>actIds.includes(m.id)).slice(0,4);
  const kids = getKids();
  act.forEach(c=>{
    const card = document.createElement('div'); card.className='choice'; card.dataset.choice=c.id;
    card.innerHTML = `
      <div class="food-head"><div class="food-emoji">${c.emoji}</div><div class="food-name" style="font-weight:900">${escapeHtml(c.label)}</div></div>
      <div class="avatars"></div>
      <div class="empty-hint">Tap to select</div>`;
    const wrap = card.querySelector('.avatars');
    kids.forEach(k=>{
      if (picks[k.id]===c.id){
        const a=document.createElement('div'); a.className='avatar'; a.title=k.name;
        a.innerHTML = k.photo?`<img alt="${escapeHtml(k.name)}" src="${k.photo}">`:`<span>${initials(k.name)}</span>`;
        wrap.appendChild(a);
      }
    });
    if (wrap.children.length) card.querySelector('.empty-hint').style.display='none';
    grid.appendChild(card);
  });
}

function renderSummary(){
  const s = $('#summary'); if (!s) return;
  s.innerHTML='';
  const date = $('#theDate').value; const picks = getDay(date);
  const kids = getKids(); const all = getAllMenu();
  kids.forEach(k=>{
    const ch = all.find(c=>c.id===picks[k.id]);
    const item = document.createElement('div'); item.className='summary-item';
    item.innerHTML = `
      <div style="display:flex; align-items:center; gap:10px">
        <div class="face" style="width:42px;height:42px">${k.photo?`<img alt="${escapeHtml(k.name)}" src="${k.photo}">`:`<span>${initials(k.name)}</span>`}</div>
        <div style="font-weight:800">${escapeHtml(k.name)}</div>
      </div>
      ${ch?`<div class="pill"><span class="emoji">${ch.emoji}</span> ${escapeHtml(ch.label)}</div>`:`<div class="pill" style="opacity:.6">Not chosen</div>`}
    `;
    s.appendChild(item);
  });
}

function renderAll(){
  renderKids(); renderChoices(); renderSummary(); attachMainInteractions();
}

// ---- Photo compression ----
function compress(file, maxSide=256, quality=0.8){
  return new Promise(resolve=>{
    const img=new Image();
    img.onload=()=>{
      const scale=Math.min(1, maxSide/Math.max(img.width,img.height));
      const w=Math.max(1,Math.round(img.width*scale)), h=Math.max(1,Math.round(img.height*scale));
      const c=document.createElement('canvas'); c.width=w; c.height=h;
      c.getContext('2d').drawImage(img,0,0,w,h);
      resolve(c.toDataURL('image/jpeg', quality));
    };
    const r=new FileReader(); r.onload=()=>img.src=r.result; r.readAsDataURL(file);
  });
}

// ---- Admin builders ----
function buildAdminKids(){
  const list = $('#kidsList'); if (!list) return;
  list.innerHTML='';
  const kids = getKids();
  kids.forEach(k=>{
    const row = document.createElement('div'); row.className='item'; row.dataset.kid=k.id;
    row.innerHTML = `
      <div class="face" style="width:44px;height:44px">${k.photo?`<img alt="${escapeHtml(k.name)}" src="${k.photo}">`:`<span>${initials(k.name)}</span>`}</div>
      <input type="text" class="grow" value="${escapeHtml(k.name)}" placeholder="Name">
      <button class="icon-btn" data-photo>Change Photo</button>
      <button class="btn-warn" data-remove>Remove</button>`;
    list.appendChild(row);
  });

  const addBtn = $('#addKid'); if (addBtn) addBtn.onclick = ()=>{
    const name = ($('#newKidName')?.value||'').trim(); if(!name) return;
    const kids2 = getKids(); kids2.push({id:uid(), name, photo:null}); setKids(kids2);
    if ($('#newKidName')) $('#newKidName').value='';
    buildAdminKids(); renderAll();
  };

  $$('#kidsList .item').forEach(r=>{
    const id = r.dataset.kid;
    $('input',r).oninput = (e)=>{ const kids2=getKids(); const k=kids2.find(x=>x.id===id); if(!k) return; k.name=e.target.value; setKids(kids2); renderKids(); renderSummary(); };
    $('[data-photo]',r).onclick = ()=> pickPhotoFor(id);
    $('[data-remove]',r).onclick = ()=>{
      setKids(getKids().filter(x=>x.id!==id));
      const d=$('#theDate').value, picks=getDay(d); delete picks[id]; setDay(d,picks);
      buildAdminKids(); renderAll();
    };
  });
}

function buildAdminMenu(){
  const sel = $('#menuEmoji'), label=$('#menuLabel'), addBtn=$('#addMenu'), listWrap=$('#menuList'), activeWrap=$('#activeList');
  if (!sel || !label || !addBtn || !listWrap || !activeWrap) return;

  sel.innerHTML=''; EMOJI_CHOICES.forEach(e=>{ const o=document.createElement('option'); o.value=e; o.textContent=e; sel.appendChild(o); });

  renderMenuList(); renderActiveList();

  addBtn.onclick = () => {
    const all=getAllMenu(); if(all.length>=10){alert('Max 10 stored menu items reached.'); return;}
    const emoji=sel.value||'üçΩÔ∏è'; const text=(label.value||'').trim(); if(!text){alert('Enter a label.'); return;}
    all.push({id:uid(), emoji, label:text}); setAllMenu(all); label.value=''; renderMenuList();
  };
}

function renderMenuList(){
  const wrap=$('#menuList'); if (!wrap) return; wrap.innerHTML='';
  const all=getAllMenu();
  all.forEach(m=>{
    const row=document.createElement('div'); row.className='item'; row.dataset.id=m.id;
    row.innerHTML=`<div style="font-size:24px">${m.emoji}</div><input type="text" class="grow" value="${escapeHtml(m.label)}"><button class="btn-warn" data-remove>Remove</button>`;
    wrap.appendChild(row);
  });
  $$('#menuList .item').forEach(row=>{
    const id=row.dataset.id;
    $('input',row).oninput=(e)=>{ const all=getAllMenu(); const it=all.find(x=>x.id===id); if(!it) return; it.label=e.target.value; setAllMenu(all); renderAll(); };
    $('[data-remove]',row).onclick=()=>{
      setAllMenu(getAllMenu().filter(x=>x.id!==id));
      setActive(getActive().filter(x=>x!==id));
      const d=$('#theDate').value, picks=getDay(d); for(const k in picks) if(picks[k]===id) delete picks[k]; setDay(d,picks);
      renderMenuList(); renderActiveList(); renderAll();
    };
  });
}

function renderActiveList(){
  const wrap=$('#activeList'); if (!wrap) return; wrap.innerHTML='';
  const all=getAllMenu(); const act=getActive();
  all.forEach(m=>{
    const row=document.createElement('div'); row.className='item'; row.dataset.id=m.id;
    row.innerHTML = `<div style="font-size:24px">${m.emoji}</div><div class="grow small">${escapeHtml(m.label)}</div><label class="row small"><input type="checkbox" ${act.includes(m.id)?'checked':''}> Active</label>`;
    wrap.appendChild(row);
  });
  $$('#activeList .item input[type="checkbox"]').forEach(cb=>{
    cb.onchange = (e)=>{
      const id=e.target.closest('.item').dataset.id; let a=getActive();
      if(e.target.checked){ if(a.length>=4){ e.target.checked=false; alert('You can only have up to 4 active choices.'); return; } a=[...new Set(a.concat(id))]; }
      else { a=a.filter(x=>x!==id); }
      setActive(a); renderAll();
    };
  });
}

// ---- Photo picker ----
function pickPhotoFor(kidId){
  const input = $('#file-picker'); if (!input) return;
  const useCamera = confirm('Use camera to take a new photo? (Cancel = choose from Photo Library/Files)');
  if (useCamera) input.setAttribute('capture','environment'); else input.removeAttribute('capture');
  input.onchange = async (ev)=>{
    const file = ev.target.files && ev.target.files[0]; if(!file) return;
    const dataUrl = await compress(file, 256, 0.8);
    try{
      const kids=getKids(); const k=kids.find(x=>x.id===kidId); if(!k) return;
      k.photo = dataUrl; setKids(kids); buildAdminKids(); renderAll();
    }catch(_){ alert('Could not save photo (storage may be full). Try a smaller image or remove a photo first.'); }
    input.value=''; input.removeAttribute('capture');
  };
  input.click();
}

// ---- Main interactions ----
function attachMainInteractions(){
  $$('#kidsRow .kid').forEach(k=>{
    k.onclick = () => {
      activeKid = k.dataset.kid;
      $$('#kidsRow .kid').forEach(el=>el.setAttribute('aria-selected','false'));
      k.setAttribute('aria-selected','true');
    };
  });
  $$('#choicesGrid .choice').forEach(c=>{
    c.onclick = () => {
      if (!activeKid) return;
      const date = $('#theDate').value; const picks = getDay(date);
      picks[activeKid] = c.dataset.choice; setDay(date,picks); renderAll();
    };
  });
}

// ---- Top controls + modal wiring ----
function bindTopControls(){
  const d = $('#theDate'); if (d) d.value = today();
  $('#btnClear')?.addEventListener('click', ()=>{ const t=$('#theDate').value; localStorage.removeItem(LS.day(t)); renderAll(); });
  $('#btnRandomize')?.addEventListener('click', ()=>{
    const t=$('#theDate').value; const kids=getKids(); const act=getActive(); const picks={};
    kids.forEach(k=>{ picks[k.id] = act[Math.floor(Math.random()*act.length)] });
    setDay(t, picks); renderAll();
  });
  $('#btnShare')?.addEventListener('click', async ()=>{
    const t=$('#theDate').value; const kids=getKids(); const picks=getDay(t); const all=getAllMenu();
    const lines = kids.map(k=>{ const ch=all.find(c=>c.id===picks[k.id]); return `${k.name}: ${ch?`${ch.emoji} ${ch.label}`:'‚Äî'}`; });
    const txt = `Breakfast Picks for ${t}\n`+lines.join('\n');
    try{ await navigator.clipboard.writeText(txt); alert('Summary copied to clipboard!'); }catch(_){ prompt('Copy the summary:', txt); }
  });

  $('#btnAdmin')?.addEventListener('click', openAdmin);
  $('#adminClose')?.addEventListener('click', closeAdmin);
  $('#adminCancel')?.addEventListener('click', closeAdmin);
  $('#adminSave')?.addEventListener('click', closeAdmin);

  $$('.tab').forEach(t=>t.addEventListener('click', ()=>{
    const tab = t.dataset.tab;
    $$('.tab').forEach(x=>x.setAttribute('aria-selected','false')); t.setAttribute('aria-selected','true');
    $$('.tab-panel').forEach(p=>p.style.display = (p.dataset.panel===tab ? '' : 'none'));
  }));
}

function openAdmin(){
  const modal = $('#adminModal'); if (!modal) return;
  modal.style.display='flex'; modal.setAttribute('aria-hidden','false');
  try{ buildAdminKids(); }catch(e){ console.warn('buildAdminKids failed', e); }
  try{ buildAdminMenu(); }catch(e){ console.warn('buildAdminMenu failed', e); }
}
function closeAdmin(){
  const modal = $('#adminModal'); if (!modal) return;
  modal.style.display='none'; modal.setAttribute('aria-hidden','true');
}

// ---- Boot ----
(function init(){
  ensureSeed();
  bindTopControls();
  renderAll();

  // SW registration (uses your shared sw.js)
  if ('serviceWorker' in navigator) window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(()=>{}));
})();
</script>
</body>
</html>
